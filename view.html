<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Preview</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

    <style>
        /* --- 1. SETUP KANVAS --- */
        html { background-color: #000000; height: 100%; }
        body {
            background-color: transparent !important; 
            min-height: 100vh; margin: 0; padding: 0;
            font-family: 'Montserrat', sans-serif; color: white;
            display: flex; flex-direction: column;
            opacity: 0; animation: fadeInPage 0.8s ease-out forwards;
        }

        @keyframes fadeInPage { to { opacity: 1; } }
        body.fade-out { opacity: 0; transition: opacity 0.5s ease; }

        /* --- 2. BACKGROUND --- */
        .bg-fixed {
            position: fixed; top: -10%; left: -10%; width: 120%; height: 120vh;
            background-image: url('https://ik.imagekit.io/rmdzAV/Sheva%20Personality/Background.jpg');
            background-size: cover; background-position: center;
            z-index: 0;
        }

        .overlay {
            position: fixed; top: -10%; left: -10%; width: 120%; height: 120vh;
            background: rgba(0, 0, 0, 0.75);
            z-index: 1; pointer-events: none;
        }

        /* --- 3. KONTEN --- */
        .preview-nav, .code-container { position: relative; z-index: 2; }

        /* HEADER GLASS STYLE */
        .preview-nav {
            padding: 20px 40px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1); 
            background: rgba(0,0,0,0.4); backdrop-filter: blur(10px);
        }
        .back-btn {
            text-decoration: none; color: #ccc; font-size: 14px; display: flex; align-items: center; gap: 8px;
            padding: 8px 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); transition: 0.3s;
        }
        .back-btn:hover { background: #FF5400; border-color: #FF5400; color: white; box-shadow: 0 0 15px #FF5400; }
        .file-name { font-family: 'Fira Code', monospace; color: #FF5400; font-weight: 500; text-shadow: 0 0 10px rgba(255,84,0,0.5); }

        /* CODE CONTAINER */
        .code-container {
            flex: 1; max-width: 1000px; width: 90%; margin: 40px auto;
            background: rgba(20, 20, 20, 0.65);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-radius: 15px; 
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            overflow: hidden; display: flex; flex-direction: column;
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        
        /* WINDOW BAR (HEADER CARD) */
        .window-bar {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px 15px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        /* Grup Titik Mac (Kiri) */
        .dots-group { display: flex; gap: 8px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; }
        .red { background: #ff5f56; } .yellow { background: #ffbd2e; } .green { background: #27c93f; }

        /* Grup Word Wrap (Kanan) */
        .wrap-toggle-group {
            display: flex; align-items: center; gap: 10px;
            font-size: 12px; font-weight: 600; color: #aaa;
            font-family: 'Montserrat', sans-serif;
            cursor: pointer; transition: 0.3s;
        }
        .wrap-toggle-group:hover { color: #fff; }
        
        /* --- CUSTOM CHECKBOX DESIGN (NEON GLOW) --- */
        .wrap-toggle-group input[type="checkbox"] {
            /* Reset Default Style */
            appearance: none; -webkit-appearance: none;
            
            width: 16px; height: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;

            /* STATE OFF: Putih Transparan + Glow Putih Redup */
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.1); 
        }

        /* STATE ON: Orange + Glow Orange Kuat */
        .wrap-toggle-group input[type="checkbox"]:checked {
            background: #FF5400;
            border-color: #FF5400;
            box-shadow: 0 0 10px #FF5400, 0 0 20px rgba(255, 84, 0, 0.5); /* Efek Neon */
        }

        /* Icon Centang Manual (Agar terlihat jelas) */
        .wrap-toggle-group input[type="checkbox"]:checked::after {
            content: 'âœ”';
            color: white; font-size: 10px; font-weight: bold;
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
        }

        /* KONTEN KODE */
        .code-content {
            padding: 20px; overflow-x: auto; margin: 0;
            font-family: 'Fira Code', monospace; font-size: 12px; line-height: 1.6;
            background: transparent !important;
            text-shadow: none !important;
            
            /* Default: Scroll Horizontal */
            white-space: pre; 
            overflow-wrap: normal;
        }
        
        /* Override Style bawaan Prism JS */
        pre[class*="language-"], code[class*="language-"] { 
            background: transparent !important; 
            margin: 0 !important; 
            text-shadow: none !important; 
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #FF5400; }

        @media (max-width: 768px) {
            .preview-nav { padding: 15px 20px; flex-direction: column; gap: 15px; }
            .file-name { order: -1; margin-bottom: 5px; }
            .code-container { margin: 20px auto; width: 95%; }
            .code-content { font-size: 10px; line-height: 1.5; }
        }
    </style>
</head>
<body>

    <div class="bg-fixed"></div>
    <div class="overlay"></div>

    <div class="preview-nav">
        <a href="commits.html" class="back-btn" id="backBtn"><i class="fas fa-arrow-left"></i> Back to List</a>
        <div class="file-name" id="fileNameTitle">Loading...</div>
        <div style="width: 80px;"></div> 
    </div>

    <div class="code-container">
        <div class="window-bar">
            <div class="dots-group">
                <div class="dot red"></div><div class="dot yellow"></div><div class="dot green"></div>
            </div>
            
            <label class="wrap-toggle-group">
                Word Wrap
                <input type="checkbox" id="wordWrapToggle">
            </label>
        </div>

        <pre><code id="codeBlock" class="language-clike">Fetching data...</code></pre>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

    <script>
        // Back Button
        document.getElementById('backBtn').addEventListener('click', (e) => {
            e.preventDefault();
            document.body.classList.add('fade-out');
            setTimeout(() => { window.location.href = 'commits.html'; }, 500);
        });

        const urlParams = new URLSearchParams(window.location.search);
        const fileUrl = urlParams.get('file');
        const fileName = urlParams.get('name');

        const titleEl = document.getElementById('fileNameTitle');
        const codeEl = document.getElementById('codeBlock');
        const preEl = codeEl.parentElement; // Element <pre>

        // --- FITUR WORD WRAP (PERBAIKAN LOGIKA) ---
        const wrapToggle = document.getElementById('wordWrapToggle');
        
        wrapToggle.addEventListener('change', function() {
            // Kita terapkan style ke DUA elemen sekaligus (<pre> dan <code>)
            // Ini untuk memastikan Prism.js tidak menimpa settingan kita
            const modeWrap = this.checked ? 'pre-wrap' : 'pre';
            const modeBreak = this.checked ? 'break-word' : 'normal';

            // Pakai setProperty 'important' untuk memaksa style
            preEl.style.setProperty('white-space', modeWrap, 'important');
            codeEl.style.setProperty('white-space', modeWrap, 'important');
            
            preEl.style.overflowWrap = modeBreak;
        });

        // --- FETCH DATA ---
        if (fileName) {
            titleEl.textContent = fileName;
            const ext = fileName.split('.').pop().toLowerCase();
            
            if (ext === 'sql') codeEl.className = 'language-sql';
            else if (ext === 'cpp') codeEl.className = 'language-cpp';
            else if (ext === 'py') codeEl.className = 'language-python';
            else if (ext === 'html') codeEl.className = 'language-html';
            else if (ext === 'js') codeEl.className = 'language-javascript';
            else codeEl.className = 'language-none';
        }

        if (fileUrl) {
            fetch(fileUrl)
                .then(response => {
                    if (!response.ok) throw new Error("Gagal mengambil file");
                    return response.text();
                })
                .then(text => {
                    const safeText = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
                    codeEl.innerHTML = safeText;
                    Prism.highlightElement(codeEl);
                })
                .catch(err => {
                    codeEl.textContent = "Error: File tidak ditemukan atau private.";
                    codeEl.style.color = "red";
                });
        } else {
            codeEl.textContent = "No file selected.";
        }
    </script>
</body>
</html>
